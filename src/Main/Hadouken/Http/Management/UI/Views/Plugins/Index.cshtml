@{
    Layout = "Shared/Layout.cshtml";
}

@section Scripts
{
    <script type="text/javascript" src="/Scripts/zip.js"></script>
    <script type="text/javascript" src="/Scripts/manifest.js"></script>
    <script type="text/javascript" src="/Scripts/Plugins.js"></script>
}

<div class="row">
    <div class="col-lg-12">
        <h1>Plugins</h1>
        
        <p>From here you can list your installed plugins, install new ones from the repository or uninstall the ones you're unhappy with.</p>
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        <h2>Your plugins <button type="button" class="btn btn-sm btn-primary btn-upload-package">Upload</button></h2>
        
        @if (!Model.HasPlugins)
        {
            <p><em>You have no plugins installed.</em></p>
        }
        else
        {
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>State</th>
                        <th>Version</th>
                        <th>Mem. usage</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="plugins-list">
                    @foreach (var plugin in Model.Plugins)
                    {
                        <tr data-plugin-id="@plugin.Name">
                            <td>@plugin.Name</td>
                            <td>@plugin.StateMessage</td>
                            <td>@plugin.Version</td>
                            <td>@plugin.MemoryUsage</td>
                            <td>
                                <div class="pull-right">
                                    <button type="button" class="btn btn-xs btn-primary btn-plugin-details pull-right">Details</button>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>
</div>

<script type="text/x-html-template" id="upload-template" data-title="Upload plugin">
    <p>Use the form below to manually upload a plugin package. <em>If it has dependencies which can not be met, it will fail to load.</em></p>

    <form role="form" class="form-horizontal">
        <div class="form-group">
            <label for="package" class="col-md-3 control-label">Package file</label>
            <div class="col-md-9">
                <input type="file" class="form-control" name="package" id="package" />
            </div>
        </div>
        
        <div class="form-group manifest-data">
            <label class="col-md-3 control-label">Dependencies</label>
            <div class="col-md-9">
                <p class="form-control-static">
                    <ul id="dependenciesList">
                        <li><span class="label label-success">None</span></li>
                    </ul>
                </p>
            </div>
        </div>
        
        <div class="form-group manifest-data">
            <label class="col-md-3 control-label">Permissions</label>
            <div class="col-md-9">
                <p class="form-control-static">
                    <ul id="permissionsList">
                        <li><span class="label label-warning">Unrestricted</span></li>
                    </ul>
                </p>
            </div>
        </div>
        
        <p class="manifest-data">Enter your password to proceed with the installation.</p>

        <div class="form-group manifest-data">
            <label for="password" class="col-md-3 control-label">Password</label>
            <div class="col-md-9">
                <input type="password" class="form-control" name="password" id="password" />
            </div>
        </div>
    </form>
</script>

<script type="text/x-html-template" id="details-template">
    <table class="table table-borderless">
        <tr>
            <td style="width: 25%;"><strong>Name</strong></td>
            <td><span class="pluginName"></span></td>
        </tr>
        <tr>
            <td style="width: 25%;"><strong>Version</strong></td>
            <td><span class="pluginVersion"></span></td>
        </tr>
        <tr>
            <td style="width: 25%;"><strong>Path</strong></td>
            <td>
                <div style="white-space: nowrap;overflow-x: auto;width:400px;" class="pluginPath"></div>
            </td>
        </tr>
    </table>
</script>